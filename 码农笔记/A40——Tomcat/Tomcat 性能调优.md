
#Tomcat 

# Tomcat 性能测试
两个指标量化 ：

1. 响应时间 ：某个操作耗时
2. 吞吐量 ： 给定时间内，系统支持的事务数量，TPS

性能测试工具
**ApacheBench、ApacheJMeter**、WCAT、WebPolygraph、LoadRunner

# Tomcat 性能调优
2个重点：内存分配、GC策略

## JVM内存参数
| 参数 | 参数作用 | 优化建议 |
| --- | --- | --- |
| -server | 启动Server，以服务端模式运行 |  服务端模式建议开启
 |
| -Xms | 最小堆内存 | 建议与-Xmx设置相同 |
| -Xmx | 最大堆内存 | 建议设置为可用内存的80% |
| -XX:MetaspaceSize | 元空间初始值 |  |
| -XX:MaxMetaspaceSize | 元空间最大内存 | 默认无限 |
| -XX:MaxNewSize | 新生代最大内存 | 默认16M |
| -XX:NewRatio | 年轻代和老年代大小比值，取值为整数，默认为2 | 不建议修改 |
| -XX:SurvivorRatio | Eden区与Survivor区大小的比值，取值为整数，默认为8 | 不建议修改 |


```bash
JAVA_OPTS="-server -Xms2048m -Xmx2048m -XX:MetaspaceSize=256m -
XX:MaxMetaspaceSize=512m -XX:SurvivorRatio=8"
```

## GC策略
JVM垃圾回收性能有以下两个主要的指标:

1. 吞吐量：工作时间（排除GC时间）占总时间的百分比， 工作时间并不仅是程序运行的时间，还包含内存分配时间。

2. 暂停时间：测试时间段内，由垃圾回收导致的应用程序停止响应次数/时间。

在Sun公司推出的HotSpotJVM中， 包含以下几种不同类型的垃圾收集器：

1. 串行收集器（Serial Collector）

采用单线程执行所有的垃圾回收工作， 适用于单核CPU服务器，无法利用多核硬件的优势

2. 并行收集器（Parallel Collector）

又称为吞吐量收集器， 以并行的方式执行年轻代的垃圾回收， 该方式可以显著降低垃圾回收的开销(指多条垃圾收集线程并行工作，但此时用户线程仍然处于等待状态)。适用于多处理器或多线程硬件上运行的数据量较大的应用

3. 并发收集器（Concurrent Collector）

以并发的方式执行大部分垃圾回收工作，以缩短垃圾回收的暂停时间。适用于那些响应时间优先于吞吐量的应用， 因为该收集器虽然最小化了暂停时间(指用户线程与垃圾收集线程同时执行,但不一定是并行的，可能会交替进行)， 但是会降低应用程序的性能

4. CMS收集器（Concurrent Mark Sweep Collector）

并发标记清除收集器， 适用于那些更愿意缩短垃圾回收暂停时间并且负担的起与垃圾回收共享处理器资源的应用

5. G1收集器（Garbage-First Garbage Collector）

适用于大容量内存的多核服务器， 可以在满足垃圾回收暂停时间目标的同时，以最大可能性实现高吞吐量(JDK1.7之后)

不同的应用程序， 对于垃圾回收会有不同的需求。 JVM 会根据运行的平台、服务器资源配置情况选择合适的垃圾收集器、堆内存大小及运行时编译器。如无法满足需求， 参考以下准则：
A. 程序数据量较小，选择串行收集器。
B. 应用运行在单核处理器上且没有暂停时间要求， 可交由JVM自行选择或选择串行收集器。
C. 如果考虑应用程序的峰值性能， 没有暂停时间要求， 可以选择并行收集器。
D. 如果应用程序的响应时间比整体吞吐量更重要， 可以选择并发收集器。




















